<?/** * Klass dlya raboty s profilem modulya XLS_IMPORT */class CSofteffectXlsProfile {	const TABLE = 'xls_profile';	// Vozvraschaet CDBResult spisok profiley so vsemi parametrami	static public function getAll()	{		global $DB;		$strSql = "SELECT * from ".self::TABLE;		return $DB->Query($strSql, false);	}	// spisok poley tablicy	static public function getFields() {		global $DB;		$strSql = "SHOW COLUMNS FROM ".self::TABLE;		return $DB->Query($strSql, false);	}	// Sohranyaet parametry profilya	static public function save($id, $data) {		global $DB;		$sql = "";		$sql .= "UPDATE ".self::TABLE." ";		$sql .= "SET id = ".(int)$id;		foreach ($data as $code=>$value) {			if ($code!='name') {				$valCompl = mysql_escape_string(serialize($value));			} else {				$valCompl = mysql_escape_string($value);			}			$sql .= ", " . mysql_escape_string($code) . " = '" . $valCompl . "' ";		}		$sql .= "WHERE id = ".(int)$id;		$DB->query($sql);	}	// Sozdaet profil' po imeni. Vozvraschaet id. Esli profil' suschestvuet, vernet suschestvuyuschiy id	static public function init($name) {		global $DB;		// найдем профиль по имени		$sql = "SELECT id FROM ".self::TABLE." WHERE name = '".mysql_escape_string($name)."'";		$dbResult = $DB->Query($sql, false);		if ($dbResult->SelectedRowsCount()) {			$arResult = $dbResult->fetch();			return $arResult['id'];		} else {			$sql = "INSERT INTO ".self::TABLE." (name) VALUES ('".mysql_escape_string($name)."')";			$dbResult = $DB->Query($sql, false);			$sql = "SELECT id FROM ".self::TABLE." ORDER BY id DESC LIMIT 1";			$dbResult = $DB->Query($sql, false);			$arResult = $dbResult->fetch();			return $arResult['id'];		}	}	// Udalyaet profil' po ID	static public function delete($id) {		global $DB;		$strSql = "DELETE FROM ".self::TABLE." WHERE id = ".(int)$id;		$DB->Query($strSql, false);	}	// Vozvraschaet massiv dannyh profilya po ID	static public function get($id) {		global $DB;		$strSql = "SELECT * FROM ".self::TABLE." WHERE id = ".(int)$id;		$arResult = array();		$result = $DB->Query($strSql, false)->fetch();		foreach ($result as $code=>$value) {			$arResult[$code] = unserialize($value);		}		return $arResult;	}}?>