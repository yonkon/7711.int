(function(e){if(e.BX["UploaderQueue"])return false;var t=e.BX,i={"new":0,ready:1,preparing:2,inprogress:3,done:4,failed:5,stopped:6,changed:7,uploaded:8};t.UploaderQueue=function(e,i,s){this.dialogName="BX.UploaderQueue";i=!!i?i:{};this.limits={phpPostMaxSize:i["phpPostMaxSize"],phpUploadMaxFilesize:i["phpUploadMaxFilesize"],uploadMaxFilesize:i["uploadMaxFilesize"]>0?i["uploadMaxFilesize"]:0,uploadFileWidth:i["uploadFileWidth"]>0?i["uploadFileWidth"]:0,uploadFileHeight:i["uploadFileHeight"]>0?i["uploadFileHeight"]:0};this.placeHolder=t(e["placeHolder"]);this.showImage=e["showImage"]!==false;this.uploader=s;this.itForUpload=new t.UploaderUtils.Hash;this.items=new t.UploaderUtils.Hash;this.itUploaded=new t.UploaderUtils.Hash;this.itFailed=new t.UploaderUtils.Hash;this.thumb={tagName:"LI",className:"bx-bxu-thumb-thumb"};if(!!e["thumb"]){for(var r in e["thumb"]){if(e["thumb"].hasOwnProperty(r)&&this.thumb.hasOwnProperty(r)){this.thumb[r]=e["thumb"][r]}}}t.addCustomEvent(s,"onItemIsAdded",t.delegate(this.addItem,this));t.addCustomEvent(s,"onItemsAreAdded",t.delegate(this.finishQueue,this));t.addCustomEvent(s,"onFileIsDeleted",t.delegate(this.deleteItem,this));t.addCustomEvent(s,"onFileIsReinited",t.delegate(this.reinitItem,this));this.log("Initialized");return this};t.UploaderQueue.prototype={showError:function(e){this.log("Error! "+e)},log:function(e){t.UploaderUtils.log("queue",e)},addItem:function(s,r){var d;if(!this.showImage)d=false;else if(t.type.isDomNode(s))d=t.UploaderUtils.isImage(s.value,null,null);else d=t.UploaderUtils.isImage(s["name"],s["type"],s["size"]);t.onCustomEvent(this.uploader,"onFileIsBeforeCreated",[s,r,d,this.uploader]);var a={copies:this.uploader.fileCopies,fields:this.uploader.fileFields},o=d?new t.UploaderImage(s,a,this.limits,this.uploader):new t.UploaderFile(s,a,this.limits,this.uploader),l,n,h={status:i.ready};t.onCustomEvent(o,"onFileIsAfterCreated",[o,r,h,this.uploader]);t.onCustomEvent(this.uploader,"onFileIsAfterCreated",[o,r,h,this.uploader]);this.items.setItem(o.id,o);if(r||h["status"]!==i.ready){this.itUploaded.setItem(o.id,o)}else{this.itForUpload.setItem(o.id,o)}if(!!this.placeHolder){if(t(r)){o.thumbNode=n=t(r)}else{l=o.makeThumb();n=t.create(this.thumb.tagName,{attrs:{id:o.id+"Item","bx-bxu-item-id":o.id,className:this.thumb.className}});if(t.type.isNotEmptyString(l)){if(this.thumb.tagName=="TR"){l=l.replace(/[\n\t]/gi,"").replace(/^(\s+)(.*?)/gi,"$2").replace(/(.*?)(\s+)$/gi,"$1");if(!!l["trim"])l=l.trim();var u=function(e,t,i){var s=n.insertCell(-1),r={colspan:true,headers:true,accesskey:true,"class":true,contenteditable:true,contextmenu:true,dir:true,hidden:true,id:true,lang:true,spellcheck:true,style:true,tabindex:true,title:true,translate:true},d;s.innerHTML=i;t=t.split(" ");while((d=t.pop())&&d){d=d.split("=");if(d.length==2){d[0]=d[0].replace(/^(\s+)(.*?)/gi,"$2").replace(/(.*?)(\s+)$/gi,"$1").replace(/^["'](.*?)["']$/gi,"$1");d[1]=d[1].replace(/^(\s+)(.*?)/gi,"$2").replace(/(.*?)(\s+)$/gi,"$1").replace(/^["'](.*?)["']$/gi,"$1");if(r[d[0]]===true)s.setAttribute(d[0],d[1]);else s[d[0]]=d[1]}}return""},p=/^<td(.*?)>(.*?)<\/td>/i;e.data1=l;while(p.test(l))l=l.replace(p,u)}else{n.innerHTML=l}}else if(t.type.isDomNode(l)){t.adjust(n,{children:[l]})}}if(!!e["jsDD"]){if(!this._onbxdragstart){this._onbxdragstart=t.delegate(this.onbxdragstart,this);this._onbxdragstop=t.delegate(this.onbxdragstop,this);this._onbxdrag=t.delegate(this.onbxdrag,this);this._onbxdraghout=t.delegate(this.onbxdraghout,this);this._onbxdestdraghover=t.delegate(this.onbxdestdraghover,this);this._onbxdestdraghout=t.delegate(this.onbxdestdraghout,this);this._onbxdestdragfinish=t.delegate(this.onbxdestdragfinish,this)}t.addClass(n,"bx-drag-draggable");n.onbxdragstart=this._onbxdragstart;n.onbxdragstop=this._onbxdragstop;n.onbxdrag=this._onbxdrag;n.onbxdraghout=this._onbxdraghout;e.jsDD.registerObject(n);n.onbxdestdraghover=this._onbxdestdraghover;n.onbxdestdraghout=this._onbxdestdraghout;n.onbxdestdragfinish=this._onbxdestdragfinish;e.jsDD.registerDest(n)}if(t(r)){t.onCustomEvent(this.uploader,"onFileIsBound",[o.id,o,this.caller,r]);t.onCustomEvent(o,"onFileIsBound",[o.id,o,this.caller,r])}else if(!!r){this.placeHolder.appendChild(n);t.onCustomEvent(this.uploader,"onFileIsAttached",[o.id,o,this.caller,r]);t.onCustomEvent(o,"onFileIsAttached",[o.id,o,this.caller,r])}else{this.placeHolder.appendChild(n);t.onCustomEvent(this.uploader,"onFileIsAppended",[o.id,o,this.caller]);t.onCustomEvent(o,"onFileIsAppended",[o.id,o,this.caller])}}t.onCustomEvent(this.uploader,"onQueueIsChanged",[this,"add",o.id,o])},getItem:function(e){var i=this.items.getItem(e);if(i)return{item:i,node:i.thumbNode||t(e+"Item")};return null},onbxdragstart:function(){var e=t.proxy_context;e.__dragCopyDiv=t.create("DIV",{attrs:{className:"bx-drag-object"},style:{position:"absolute",zIndex:10,width:e.clientWidth+"px"},html:e.innerHTML});document.body.appendChild(e.__dragCopyDiv);t.addClass(e,"bx-drag-source");return true},onbxdragstop:function(){var e=t.proxy_context;t.removeClass(e,"bx-drag-source");if(!!e.__dragCopyDiv){e.__dragCopyDiv.parentNode.removeChild(e.__dragCopyDiv);e.__dragCopyDiv=null}return true},onbxdrag:function(e,i){var s=t.proxy_context,r=s.__dragCopyDiv;r.style.left=e+"px";r.style.top=i+"px"},onbxdraghout:function(e,t,i){},onbxdestdraghover:function(){var e=t.proxy_context;t.addClass(e,"bx-drag-over");return true},onbxdestdraghout:function(){var e=t.proxy_context;t.removeClass(e,"bx-drag-over");return true},onbxdestdragfinish:function(e){var i=t.proxy_context;t.removeClass(i,"bx-drag-over");if(i==e||!t.hasClass(e,"bx-drag-draggable"))return true;else{var s=i.parentNode,r=s.childNodes.length;for(var d=0;d<r;d++){if(s.childNodes[d]==i)i.number=d;else if(s.childNodes[d]==e)e.number=d;if(e.number>0&&i.number>0)break}if(this.itForUpload.hasItem(e.getAttribute("bx-bxu-item-id"))){var a=i.number<=e.number?"beforeItem":i.nextSibling?"afterItem":"inTheEnd",o=null;if(a!="inTheEnd"){for(d=i.number+(a=="beforeItem"?0:1);d<r;d++){if(this.itForUpload.hasItem(s.childNodes[d].getAttribute("bx-bxu-item-id"))){o=s.childNodes[d].getAttribute("bx-bxu-item-id");break}}if(o===null)a="inTheEnd"}var l=this.itForUpload.removeItem(e.getAttribute("bx-bxu-item-id"));if(a!="inTheEnd")this.itForUpload.insertBeforeItem(l.id,l,o);else this.itForUpload.setItem(l.id,l)}e.parentNode.removeChild(e);if(i.number<=e.number){i.parentNode.insertBefore(e,i)}else if(i.nextSibling){i.parentNode.insertBefore(e,i.nextSibling)}else{i.parentNode.appendChild(e)}}return true},deleteItem:function(i,s){var r=this.getItem(i),d;if(r&&(!this.placeHolder||(d=r.node)&&d)){if(!!d){if(!!e["jsDD"]){d.onmousedown=null;d.onbxdragstart=null;d.onbxdragstop=null;d.onbxdrag=null;d.onbxdraghout=null;d.onbxdestdraghover=null;d.onbxdestdraghout=null;d.onbxdestdragfinish=null;d.__bxpos=null;e.jsDD.arObjects[d.__bxddid]=null;delete e.jsDD.arObjects[d.__bxddid];e.jsDD.arDestinations[d.__bxddeid]=null;delete e.jsDD.arDestinations[d.__bxddeid]}t.unbindAll(d);d.parentNode.removeChild(d)}this.items.removeItem(i);this.itUploaded.removeItem(i);this.itFailed.removeItem(i);this.itForUpload.removeItem(i);t.onCustomEvent(this.uploader,"onQueueIsChanged",[this,"add",i,s]);return true}return false},reinitItem:function(i,s){var r,d;if(!!this.placeHolder&&this.items.hasItem(i)&&(r=t(i+"Item"))&&r){d=s.makeThumb();if(t.type.isNotEmptyString(d)){if(this.thumb.tagName=="TR"){d=d.replace(/[\n\t]/gi,"").replace(/^(\s+)(.*?)/gi,"$2").replace(/(.*?)(\s+)$/gi,"$1");if(!!d["trim"])d=d.trim();var a=function(e,t,i){var s=r.insertCell(-1),d={colspan:true,headers:true,accesskey:true,"class":true,contenteditable:true,contextmenu:true,dir:true,hidden:true,id:true,lang:true,spellcheck:true,style:true,tabindex:true,title:true,translate:true},a;s.innerHTML=i;t=t.split(" ");while((a=t.pop())&&a){a=a.split("=");if(a.length==2){a[0]=a[0].replace(/^(\s+)(.*?)/gi,"$2").replace(/(.*?)(\s+)$/gi,"$1").replace(/^["'](.*?)["']$/gi,"$1");a[1]=a[1].replace(/^(\s+)(.*?)/gi,"$2").replace(/(.*?)(\s+)$/gi,"$1").replace(/^["'](.*?)["']$/gi,"$1");if(d[a[0]]===true)s.setAttribute(a[0],a[1]);else s[a[0]]=a[1]}}return""},o=/^<td(.*?)>(.*?)<\/td>/i;e.data1=d;while(o.test(d))d=d.replace(o,a)}else{r.innerHTML=d}}else if(t.type.isDomNode(d)){while(t(r.firstChild)){t.remove(r.firstChild)}t.adjust(r,{children:[d]})}t.onCustomEvent(this.uploader,"onFileIsAppended",[s.id,s,this.caller]);t.onCustomEvent(s,"onFileIsAppended",[s.id,s,this.caller])}},finishQueue:function(){},clear:function(){var e;while((e=this.items.getFirst())&&!!e)this.deleteItem(e.id,e)},restoreFiles:function(e,i){i=i===true;var s=e.getFirst();while(s){if(this.items.hasItem(s.id)&&!this.itUploaded.hasItem(s.id)&&(!i&&!this.itFailed.hasItem(s.id)||i)){if(this.itFailed.hasItem(s.id)){delete s["uploadStatus"];delete s.file["uploadStatus"];delete s.file["firstChunk"];delete s.file["package"];delete s.file["packages"];if(s.file["copies"]){s.file["copies"].reset();var r;while((r=s.file["copies"].getNext())&&r){delete r["uploadStatus"];delete r["firstChunk"];delete r["package"];delete r["packages"]}s.file["copies"].reset()}}s["restored"]="Y";this.itFailed.removeItem(s.id);this.itForUpload.setItem(s.id,s);t.onCustomEvent(s,"onUploadRestore",[s])}s=e.getNext()}}};return i})(window);
//# sourceMappingURL=queue.map.js