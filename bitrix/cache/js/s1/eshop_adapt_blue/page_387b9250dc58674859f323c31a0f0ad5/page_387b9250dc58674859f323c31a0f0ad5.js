
; /* Start:"a:4:{s:4:"full";s:89:"/bitrix/components/bitrix/sale.order.ajax/templates/.default/script.min.js?14339373826351";s:6:"source";s:70:"/bitrix/components/bitrix/sale.order.ajax/templates/.default/script.js";s:3:"min";s:74:"/bitrix/components/bitrix/sale.order.ajax/templates/.default/script.min.js";s:3:"map";s:74:"/bitrix/components/bitrix/sale.order.ajax/templates/.default/script.map.js";}"*/
BX.saleOrderAjax={BXCallAllowed:false,options:{},indexCache:{},controls:{},modes:{},properties:{},init:function(e){var t=this;this.options=e;window.submitFormProxy=BX.proxy(function(){t.submitFormProxy.apply(t,arguments)},this);BX(function(){t.initDeferredControl()});BX(function(){t.BXCallAllowed=true});this.controls.scope=BX("order_form_div");BX.bindDelegate(this.controls.scope,"click",{className:"-bx-popup-set-mode-add-loc"},function(){var e=BX.create("input",{attrs:{type:"hidden",name:"PERMANENT_MODE_STEPS",value:"1"}});BX.prepend(e,BX("ORDER_FORM"));t.BXCallAllowed=false;submitForm()})},cleanUp:function(){for(var e in this.properties){if(this.properties.hasOwnProperty(e)){if(typeof this.properties[e].input!="undefined"){BX.unbindAll(this.properties[e].input);this.properties[e].input=null}if(typeof this.properties[e].control!="undefined")BX.unbindAll(this.properties[e].control)}}this.properties={}},addPropertyDesc:function(e){this.properties[e.id]=e.attributes;this.properties[e.id].id=e.id},initDeferredControl:function(){var e=this,t,i,o,r,n,s,p,l,a;if(typeof window.BX.locationsDeferred!="undefined"){this.BXCallAllowed=false;for(t in window.BX.locationsDeferred){window.BX.locationsDeferred[t].call(this);window.BX.locationsDeferred[t]=null;delete window.BX.locationsDeferred[t];this.properties[t].control=window.BX.locationSelectors[t];delete window.BX.locationSelectors[t]}}for(t in this.properties){if(this.properties[t].isZip){i=this.controls.scope.querySelector('[data-property-id-row="'+t+'"]');if(BX.type.isElementNode(i)){o=i.querySelector('input[type="text"]');if(BX.type.isElementNode(o)){this.properties[t].input=o;r=false;for(n in this.properties){if(this.properties[n].type=="LOCATION"){r=n;break}}if(r!==false){BX.bindDebouncedChange(o,function(t){o=null;i=null;if(BX.type.isNotEmptyString(t)&&/^\s*\d+\s*$/.test(t)&&t.length>3){e.getLocationByZip(t,function(t){e.properties[r].control.setValueByLocationId(t)},function(){try{e.properties[r].control.clearSelected(locationId)}catch(t){}})}})}}}}if(this.properties[t].type=="LOCATION"){if(typeof this.properties[t].control!="undefined"){s=this.properties[t].control;p=s.getSysCode();if(typeof this.properties[t].altLocationPropId!="undefined"){if(p=="sls"){s.replaceTemplate("nothing-found",this.options.messages.notFoundPrompt)}if(p=="slst"){(function(t,i){i.setOption("pseudoValues",["other"]);i.bindEvent("control-before-display-page",function(t){i=null;var o=t.getParentValue();if(o==this.getOption("rootNodeValue")||!this.checkCanSelectItem(o))return;var r=t.getControl();if(typeof r.vars.cache.nodes["other"]=="undefined"){r.fillCache([{CODE:"other",DISPLAY:e.options.messages.otherLocation,IS_PARENT:false,VALUE:"other"}],{modifyOrigin:true,modifyOriginPosition:"prepend"})}});l=BX("LOCATION_ALT_PROP_DISPLAY_MANUAL["+parseInt(t)+"]");i.bindEvent("after-select-real-value",function(){if(BX.type.isDomNode(l))l.value="0"});i.bindEvent("after-select-pseudo-value",function(){if(BX.type.isDomNode(l))l.value="1"});i.bindEvent("before-set-value",function(){if(BX.type.isDomNode(l))l.value="0"});if(BX.type.isDomNode(l)&&l.value=="1"){a=i.getAdapterAtPosition(i.getStackSize()-1);if(typeof a!="undefined"&&a!==null)a.setValuePair("other",e.options.messages.otherLocation)}})(t,s)}}}}}this.BXCallAllowed=true},checkMode:function(e,t){if(t=="altLocationChoosen"){if(this.checkAbility(e,"canHaveAltLocation")){var i=this.getInputByPropId(this.properties[e].altLocationPropId);var o=this.properties[e].altLocationPropId;if(i!==false&&i.value.length>0&&!i.disabled&&this.properties[o].valueSource!="default"){return true}}}return false},checkAbility:function(e,t){if(typeof this.properties[e]=="undefined")this.properties[e]={};if(typeof this.properties[e].abilities=="undefined")this.properties[e].abilities={};if(typeof this.properties[e].abilities!="undefined"&&this.properties[e].abilities[t])return true;if(t=="canHaveAltLocation"){if(this.properties[e].type=="LOCATION"){if(typeof this.properties[e].altLocationPropId!="undefined"&&typeof this.properties[this.properties[e].altLocationPropId]){var i=this.properties[e].altLocationPropId;if(typeof this.properties[e].control!="undefined"&&this.properties[e].control.getSysCode()=="slst"){if(this.getInputByPropId(i)!==false){this.properties[e].abilities[t]=true;return true}}}}}return false},getInputByPropId:function(e){if(typeof this.properties[e].input!="undefined")return this.properties[e].input;var t=this.getRowByPropId(e);if(BX.type.isElementNode(t)){var i=t.querySelector('input[type="text"]');if(BX.type.isElementNode(i)){this.properties[e].input=i;return i}}return false},getRowByPropId:function(e){if(typeof this.properties[e].row!="undefined")return this.properties[e].row;var t=this.controls.scope.querySelector('[data-property-id-row="'+e+'"]');if(BX.type.isElementNode(t)){this.properties[e].row=t;return t}return false},getAltLocPropByRealLocProp:function(e){if(typeof this.properties[e].altLocationPropId!="undefined")return this.properties[this.properties[e].altLocationPropId];return false},toggleProperty:function(e,t,i){var o=this.properties[e];if(typeof o.row=="undefined")o.row=this.getRowByPropId(e);if(typeof o.input=="undefined")o.input=this.getInputByPropId(e);if(!t){if(!i)BX.hide(o.row);o.input.disabled=true}else{if(!i)BX.show(o.row);o.input.disabled=false}},submitFormProxy:function(e,t){var i=false;for(var o in this.properties){if(typeof this.properties[o].control!="undefined"&&this.properties[o].control==t){i=o;break}}if(e!="other"){if(this.BXCallAllowed){this.BXCallAllowed=false;submitForm()}}},getPreviousAdapterSelectedNode:function(e,t){var i=t.getIndex();var o=e.getAdapterAtPosition(i-1);if(typeof o!=="undefined"&&o!=null){var r=o.getControl().getValue();if(typeof r!="undefined"){var n=e.getNodeByValue(r);if(typeof n!="undefined")return n;return false}}return false},getLocationByZip:function(e,t,i){if(typeof this.indexCache[e]!="undefined"){t.apply(this,[this.indexCache[e]]);return}ShowWaitWindow();var o=this;BX.ajax({url:this.options.source,method:"post",dataType:"json",async:true,processData:true,emulateOnload:true,start:true,data:{ACT:"GET_LOC_BY_ZIP",ZIP:e},onsuccess:function(r){CloseWaitWindow();if(r.result){o.indexCache[e]=r.data.ID;t.apply(o,[r.data.ID])}else i.call(o)},onfailure:function(e,t){CloseWaitWindow()}})}};
/* End */
;
; /* Start:"a:4:{s:4:"full";s:103:"/bitrix/components/bitrix/sale.location.selector.search/templates/.default/script.min.js?14339373827436";s:6:"source";s:84:"/bitrix/components/bitrix/sale.location.selector.search/templates/.default/script.js";s:3:"min";s:88:"/bitrix/components/bitrix/sale.location.selector.search/templates/.default/script.min.js";s:3:"map";s:88:"/bitrix/components/bitrix/sale.location.selector.search/templates/.default/script.map.js";}"*/
BX.namespace("BX.Sale.component.location.selector");if(typeof BX.Sale.component.location.selector.search=="undefined"&&typeof BX.ui!="undefined"&&typeof BX.ui.widget!="undefined"){BX.Sale.component.location.selector.search=function(e,t){this.parentConstruct(BX.Sale.component.location.selector.search,e);BX.merge(this,{opts:{usePagingOnScroll:true,pageSize:10,arrowScrollAdditional:2,pageUpWardOffset:3,provideLinkBy:"id",bindEvents:{"after-input-value-modify":function(){this.ctrls.fullRoute.value=""},"after-select-item":function(e){var t=this.opts;var i=this.vars.cache.nodes[e];var s=i.DISPLAY;if(typeof i.PATH=="object"){for(var o=0;o<i.PATH.length;o++){s+=", "+this.vars.cache.path[i.PATH[o]]}}this.ctrls.inputs.fake.setAttribute("title",s);this.ctrls.fullRoute.value=s;if(typeof this.opts.callback=="string"&&this.opts.callback.length>0&&this.opts.callback in window)window[this.opts.callback].apply(this,[e,this])},"after-deselect-item":function(){this.ctrls.fullRoute.value="";this.ctrls.inputs.fake.setAttribute("title","")},"before-render-variant":function(e){if(e.PATH.length>0){var t="";for(var i=0;i<e.PATH.length;i++)t+=", "+this.vars.cache.path[e.PATH[i]];e.PATH=t}else e.PATH="";var s=this.vars.lastQuery.QUERY;if(BX.type.isNotEmptyString(s)){var o=[];if(this.opts.wrapSeparate)o=s.split(/\s+/);else o=[s];e["=display_wrapped"]=BX.util.wrapSubstring(e.DISPLAY+e.PATH,o,this.opts.wrapTagName,true)}else e["=display_wrapped"]=BX.util.htmlspecialchars(e.DISPLAY)}}},vars:{cache:{path:{},nodesByCode:{}}},sys:{code:"sls"}});this.handleInitStack(t,BX.Sale.component.location.selector.search,e)};BX.extend(BX.Sale.component.location.selector.search,BX.ui.autoComplete);BX.merge(BX.Sale.component.location.selector.search.prototype,{init:function(){if(typeof this.opts.pathNames=="object")BX.merge(this.vars.cache.path,this.opts.pathNames);this.pushFuncStack("buildUpDOM",BX.Sale.component.location.selector.search);this.pushFuncStack("bindEvents",BX.Sale.component.location.selector.search)},buildUpDOM:function(){var e=this.ctrls,t=this.opts,i=this.vars,s=this,o=this.sys.code;e.fullRoute=BX.create("input",{props:{className:"bx-ui-"+o+"-route"},attrs:{type:"text",disabled:"disabled",autocomplete:"off"}});BX.style(e.fullRoute,"paddingTop",BX.style(e.inputs.fake,"paddingTop"));BX.style(e.fullRoute,"paddingLeft",BX.style(e.inputs.fake,"paddingLeft"));BX.style(e.fullRoute,"paddingRight","0px");BX.style(e.fullRoute,"paddingBottom","0px");BX.style(e.fullRoute,"marginTop",BX.style(e.inputs.fake,"marginTop"));BX.style(e.fullRoute,"marginLeft",BX.style(e.inputs.fake,"marginLeft"));BX.style(e.fullRoute,"marginRight","0px");BX.style(e.fullRoute,"marginBottom","0px");if(BX.style(e.inputs.fake,"borderTopStyle")!="none"){BX.style(e.fullRoute,"borderTopStyle","solid");BX.style(e.fullRoute,"borderTopColor","transparent");BX.style(e.fullRoute,"borderTopWidth",BX.style(e.inputs.fake,"borderTopWidth"))}if(BX.style(e.inputs.fake,"borderLeftStyle")!="none"){BX.style(e.fullRoute,"borderLeftStyle","solid");BX.style(e.fullRoute,"borderLeftColor","transparent");BX.style(e.fullRoute,"borderLeftWidth",BX.style(e.inputs.fake,"borderLeftWidth"))}BX.prepend(e.fullRoute,e.container);e.inputBlock=this.getControl("input-block");e.loader=this.getControl("loader")},bindEvents:function(){var e=this;BX.bindDelegate(this.getControl("quick-locations",true),"click",{tag:"a"},function(){e.setValueByLocationId(BX.data(this,"id"))});this.vars.outSideClickScope=this.ctrls.inputBlock},setValueByLocationId:function(e,t){BX.Sale.component.location.selector.search.superclass.setValue.apply(this,[e,t])},setValueByLocationCode:function(e,t){var i=this.vars,s=this.opts,o=this.ctrls,n=this;this.hideError();if(e==null||e==false||typeof e=="undefined"||e.toString().length==0){this.resetVariables();BX.cleanNode(o.vars);if(BX.type.isElementNode(o.nothingFound))BX.hide(o.nothingFound);this.fireEvent("after-deselect-item");this.fireEvent("after-clear-selection");return}if(t!==false)i.forceSelectSingeOnce=true;if(typeof i.cache.nodesByCode[e]=="undefined"){this.resetNavVariables();n.downloadBundle({CODE:e},function(t){n.fillCache(t,false);if(typeof i.cache.nodesByCode[e]=="undefined"){n.showNothingFound()}else{var o=i.cache.nodesByCode[e].VALUE;if(s.autoSelectIfOneVariant||i.forceSelectSingeOnce)n.selectItem(o);else n.displayVariants([o])}},function(){i.forceSelectSingeOnce=false})}else{var a=i.cache.nodesByCode[e].VALUE;if(i.forceSelectSingeOnce)this.selectItem(a);else this.displayVariants([a]);i.forceSelectSingeOnce=false}},getNodeByValue:function(e){if(this.opts.provideLinkBy=="id")return this.vars.cache.nodes[e];else return this.vars.cache.nodesByCode[e]},setValue:function(e){if(this.opts.provideLinkBy=="id")BX.Sale.component.location.selector.search.superclass.setValue.apply(this,[e]);else this.setValueByLocationCode(e)},getValue:function(){if(this.opts.provideLinkBy=="id")return this.vars.value===false?"":this.vars.value;else{return this.vars.value?this.vars.cache.nodes[this.vars.value].CODE:""}},getSelectedPath:function(){var e=this.vars,t=[];if(typeof e.value=="undefined"||e.value==false||e.value=="")return t;if(typeof e.cache.nodes[e.value]!="undefined"){var i=BX.clone(e.cache.nodes[e.value]);if(typeof i.TYPE_ID!="undefined"&&typeof this.opts.types!="undefined")i.TYPE=this.opts.types[i.TYPE_ID].CODE;var s=i.PATH;delete i.PATH;t.push(i);if(typeof s!="undefined"){for(var o in s){var i=BX.clone(e.cache.nodes[s[o]]);if(typeof i.TYPE_ID!="undefined"&&typeof this.opts.types!="undefined")i.TYPE=this.opts.types[i.TYPE_ID].CODE;delete i.PATH;t.push(i)}}}return t},setInitialValue:function(){if(this.opts.selectedItem!==false)this.setValueByLocationId(this.opts.selectedItem);else if(this.ctrls.inputs.origin.value.length>0){if(this.opts.provideLinkBy=="id")this.setValueByLocationId(this.ctrls.inputs.origin.value);else this.setValueByLocationCode(this.ctrls.inputs.origin.value)}},addItem2Cache:function(e){this.vars.cache.nodes[e.VALUE]=e;this.vars.cache.nodesByCode[e.CODE]=e},refineRequest:function(e){var t={};if(typeof e["QUERY"]!="undefined")t["=PHRASE"]=e.QUERY;if(typeof e["VALUE"]!="undefined")t["=ID"]=e.VALUE;if(typeof e["CODE"]!="undefined")t["=CODE"]=e.CODE;if(typeof this.opts.query.BEHAVIOUR.LANGUAGE_ID!="undefined")t["=NAME.LANGUAGE_ID"]=this.opts.query.BEHAVIOUR.LANGUAGE_ID;if(BX.type.isNotEmptyString(this.opts.query.FILTER.SITE_ID))t["=SITE_ID"]=this.opts.query.FILTER.SITE_ID;return{select:{VALUE:"ID",DISPLAY:"NAME.NAME",1:"CODE",2:"TYPE_ID"},additionals:{1:"PATH"},filter:t,version:"2"}},refineResponce:function(e,t){if(typeof e.ETC.PATH_ITEMS!="undefined"){for(var i in e.ETC.PATH_ITEMS){if(BX.type.isNotEmptyString(e.ETC.PATH_ITEMS[i].DISPLAY))this.vars.cache.path[i]=e.ETC.PATH_ITEMS[i].DISPLAY}for(var i in e.ITEMS){var s=e.ITEMS[i];if(typeof s.PATH!="undefined"){var o=BX.clone(s.PATH);for(var n in s.PATH){var a=s.PATH[n];o.shift();if(typeof this.vars.cache.nodes[a]=="undefined"&&typeof e.ETC.PATH_ITEMS[a]!="undefined"){var l=BX.clone(e.ETC.PATH_ITEMS[a]);l.PATH=BX.clone(o);this.vars.cache.nodes[a]=l}}}}}return e.ITEMS},refineItems:function(e){return e},refineItemDataForTemplate:function(e){return e},getSelectorValue:function(e){if(this.opts.provideLinkBy=="id")return e;if(typeof this.vars.cache.nodes[e]!="undefined")return this.vars.cache.nodes[e].CODE;else return""},whenLoaderToggle:function(e){BX[e?"show":"hide"](this.ctrls.loader)}})}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:100:"/bitrix/components/bitrix/sale.ajax.delivery.calculator/templates/.default/proceed.js?14338395841012";s:6:"source";s:85:"/bitrix/components/bitrix/sale.ajax.delivery.calculator/templates/.default/proceed.js";s:3:"min";s:0:"";s:3:"map";s:0:"";}"*/
function deliveryCalcProceed(arParams)
{
	var delivery_id = arParams.DELIVERY;
	var profile_id = arParams.PROFILE;
	var getExtraParamsFunc = arParams.EXTRA_PARAMS_CALLBACK;

	function __handlerDeliveryCalcProceed(data)
	{
		var obContainer = document.getElementById('delivery_info_' + delivery_id + '_' + profile_id);
		if (obContainer)
		{
			obContainer.innerHTML = data;
		}

		PCloseWaitMessage('wait_container_' + delivery_id + '_' + profile_id, true);
	}

	PShowWaitMessage('wait_container_' + delivery_id + '_' + profile_id, true);
	
	var url = '/bitrix/components/bitrix/sale.ajax.delivery.calculator/templates/.default/ajax.php';
	
	var TID = CPHttpRequest.InitThread();
	CPHttpRequest.SetAction(TID, __handlerDeliveryCalcProceed);

	if(!getExtraParamsFunc)
	{
		CPHttpRequest.Post(TID, url, arParams);
	}
	else
	{
		eval(getExtraParamsFunc);

		BX.addCustomEvent('onSaleDeliveryGetExtraParams', function(params){
			arParams.EXTRA_PARAMS = params;
			CPHttpRequest.Post(TID, url, arParams);
		});

	}
}
/* End */
;
; /* Start:"a:4:{s:4:"full";s:102:"/bitrix/components/bitrix/sale.location.selector.steps/templates/.default/script.min.js?14339373826688";s:6:"source";s:83:"/bitrix/components/bitrix/sale.location.selector.steps/templates/.default/script.js";s:3:"min";s:87:"/bitrix/components/bitrix/sale.location.selector.steps/templates/.default/script.min.js";s:3:"map";s:87:"/bitrix/components/bitrix/sale.location.selector.steps/templates/.default/script.map.js";}"*/
BX.namespace("BX.Sale.component.location.selector");if(typeof BX.Sale.component.location.selector.steps=="undefined"&&typeof BX.ui!="undefined"&&typeof BX.ui.widget!="undefined"){BX.Sale.component.location.selector.steps=function(e,t){this.parentConstruct(BX.Sale.component.location.selector.steps,e);BX.merge(this,{opts:{bindEvents:{"after-select-item":function(e){if(typeof this.opts.callback=="string"&&this.opts.callback.length>0&&this.opts.callback in window)window[this.opts.callback].apply(this,[e,this])}},disableKeyboardInput:false,dontShowNextChoice:false,pseudoValues:[],provideLinkBy:"id"},vars:{cache:{nodesByCode:{}}},sys:{code:"slst"}});this.handleInitStack(t,BX.Sale.component.location.selector.steps,e)};BX.extend(BX.Sale.component.location.selector.steps,BX.ui.chainedSelectors);BX.merge(BX.Sale.component.location.selector.steps.prototype,{init:function(){this.pushFuncStack("buildUpDOM",BX.Sale.component.location.selector.steps);this.pushFuncStack("bindEvents",BX.Sale.component.location.selector.steps)},buildUpDOM:function(){},bindEvents:function(){var e=this,t=this.opts;if(t.disableKeyboardInput){this.bindEvent("after-control-placed",function(e){var t=e.getControl();BX.unbindAll(t.ctrls.toggle);BX.bind(t.ctrls.scope,"click",function(e){t.toggleDropDown()})})}BX.bindDelegate(this.getControl("quick-locations",true),"click",{tag:"a"},function(){e.setValueByLocationId(BX.data(this,"id"))})},setValueByLocationId:function(e){BX.Sale.component.location.selector.steps.superclass.setValue.apply(this,[e])},setValueByLocationCode:function(e){var t=this.vars;if(e==null||e==false||typeof e=="undefined"||e.toString().length==0){this.displayRoute([]);this.setValueVariable("");this.setTargetValue("");this.fireEvent("after-clear-selection");return}this.fireEvent("before-set-value",[e]);var s=new BX.deferred;var i=this;s.done(BX.proxy(function(s){this.displayRoute(s);var i=t.cache.nodesByCode[e].VALUE;t.value=i;this.setTargetValue(this.checkCanSelectItem(i)?i:this.getLastValidValue())},this));s.fail(function(e){if(e=="notfound"){i.displayRoute([]);i.setValueVariable("");i.setTargetValue("");i.showError({errors:[i.opts.messages.nothingFound],type:"server-logic",options:{}})}});this.hideError();this.getRouteToNodeByCode(e,s)},setValue:function(e){if(this.opts.provideLinkBy=="id")BX.Sale.component.location.selector.steps.superclass.setValue.apply(this,[e]);else this.setValueByLocationCode(e)},setTargetValue:function(e){this.setTargetInputValue(this.opts.provideLinkBy=="code"?e?this.vars.cache.nodes[e].CODE:"":e);this.fireEvent("after-select-item",[e])},getValue:function(){if(this.opts.provideLinkBy=="id")return this.vars.value===false?"":this.vars.value;else{return this.vars.value?this.vars.cache.nodes[this.vars.value].CODE:""}},getSelectedPath:function(){var e=this.vars,t=[];if(typeof e.value=="undefined"||e.value==false||e.value=="")return t;if(typeof e.cache.nodes[e.value]!="undefined"){var s=e.cache.nodes[e.value];while(typeof s!="undefined"){var i=BX.clone(s);var o=i.PARENT_VALUE;delete i.PATH;delete i.PARENT_VALUE;delete i.IS_PARENT;if(typeof i.TYPE_ID!="undefined"&&typeof this.opts.types!="undefined")i.TYPE=this.opts.types[i.TYPE_ID].CODE;t.push(i);if(typeof o=="undefined"||typeof e.cache.nodes[o]=="undefined")break;else s=e.cache.nodes[o]}}return t},setInitialValue:function(){if(this.opts.selectedItem!==false)this.setValueByLocationId(this.opts.selectedItem);else if(this.ctrls.inputs.origin.value.length>0){if(this.opts.provideLinkBy=="id")this.setValueByLocationId(this.ctrls.inputs.origin.value);else this.setValueByLocationCode(this.ctrls.inputs.origin.value)}},getRouteToNodeByCode:function(e,t){var s=this.vars,i=this;if(typeof e!="undefined"&&e!==false&&e.toString().length>0){var o=[];if(typeof s.cache.nodesByCode[e]!="undefined")o=this.getRouteToNodeFromCache(s.cache.nodesByCode[e].VALUE);if(o.length==0){i.downloadBundle({request:{CODE:e},callbacks:{onLoad:function(n){for(var a in n){if(typeof s.cache.links[a]=="undefined")s.cache.incomplete[a]=true}i.fillCache(n,true);o=[];if(typeof s.cache.nodesByCode[e]!="undefined")o=this.getRouteToNodeFromCache(s.cache.nodesByCode[e].VALUE);if(o.length==0)t.reject("notfound");else t.resolve(o)},onError:function(){t.reject("internal")}},options:{}})}else t.resolve(o)}else t.resolve([])},addItem2Cache:function(e){this.vars.cache.nodes[e.VALUE]=e;this.vars.cache.nodesByCode[e.CODE]=e},controlChangeActions:function(e,t){var s=this,i=this.opts,o=this.vars,n=this.ctrls;this.hideError();if(t.length==0){s.truncateStack(e);o.value=s.getLastValidValue();s.setTargetValue(o.value);this.fireEvent("after-select-real-value")}else if(BX.util.in_array(t,i.pseudoValues)){s.truncateStack(e);s.setTargetValue(s.getLastValidValue());this.fireEvent("after-select-item",[t]);this.fireEvent("after-select-pseudo-value")}else{var a=o.cache.nodes[t];if(typeof a=="undefined")throw new Error("Selected node not found in the cache");s.truncateStack(e);if(i.dontShowNextChoice){if(a.IS_UNCHOOSABLE)s.appendControl(t)}else{if(typeof o.cache.links[t]!="undefined"||a.IS_PARENT)s.appendControl(t)}if(s.checkCanSelectItem(t)){o.value=t;s.setTargetValue(t);this.fireEvent("after-select-real-value")}}},refineRequest:function(e){var t={};var s={VALUE:"ID",DISPLAY:"NAME.NAME",1:"TYPE_ID",2:"CODE"};var i={};if(typeof e["PARENT_VALUE"]!="undefined"){t["=PARENT_ID"]=e.PARENT_VALUE;s["10"]="IS_PARENT"}if(typeof e["VALUE"]!="undefined"){t["=ID"]=e.VALUE;i["1"]="PATH"}if(BX.type.isNotEmptyString(e["CODE"])){t["=CODE"]=e.CODE;i["1"]="PATH"}if(BX.type.isNotEmptyString(this.opts.query.BEHAVIOUR.LANGUAGE_ID))t["=NAME.LANGUAGE_ID"]=this.opts.query.BEHAVIOUR.LANGUAGE_ID;if(BX.type.isNotEmptyString(this.opts.query.FILTER.SITE_ID)){if(typeof this.vars.cache.nodes[e.PARENT_VALUE]=="undefined"||this.vars.cache.nodes[e.PARENT_VALUE].IS_UNCHOOSABLE)t["=SITE_ID"]=this.opts.query.FILTER.SITE_ID}return{select:s,filter:t,additionals:i,version:"2"}},refineResponce:function(e,t){if(e.length==0)return e;if(typeof t.PARENT_VALUE!="undefined"){var s={};s[t.PARENT_VALUE]=e["ITEMS"];e=s}else if(typeof t.VALUE!="undefined"||typeof t.CODE!="undefined"){var i={};if(typeof e.ITEMS[0]!="undefined"&&typeof e.ETC.PATH_ITEMS!="undefined"){var o=0;for(var n=e.ITEMS[0]["PATH"].length-1;n>=0;n--){var a=e.ITEMS[0]["PATH"][n];var r=e.ETC.PATH_ITEMS[a];r.IS_PARENT=true;i[o]=[r];o=r.VALUE}i[o]=[e.ITEMS[0]]}e=i}return e},showError:function(e){if(e.type!="server-logic")e.errors=[this.opts.messages.error];this.setCSSState("error",this.ctrls.scope);this.ctrls.errorMessage.innerHTML='<p><font class="errortext">'+BX.util.htmlspecialchars(e.errors.join(", "))+"</font></p>";BX.debug(e)}})}
/* End */
;; /* /bitrix/components/bitrix/sale.order.ajax/templates/.default/script.min.js?14339373826351*/
; /* /bitrix/components/bitrix/sale.location.selector.search/templates/.default/script.min.js?14339373827436*/
; /* /bitrix/components/bitrix/sale.ajax.delivery.calculator/templates/.default/proceed.js?14338395841012*/
; /* /bitrix/components/bitrix/sale.location.selector.steps/templates/.default/script.min.js?14339373826688*/

//# sourceMappingURL=page_387b9250dc58674859f323c31a0f0ad5.map.js